<template>
  <CaptainInfoModal ref="captainInfoModalRef" />
  <BookingModal ref="bookingModalRef" />
  <DeleteHarbourModal ref="deleteHarbourModalRef" />
  <div class="container p-4 glass-background">
    <div class="row justify-content-center" style="background-color: transparent">
      <h1>{{ harbourDetailedInfo.harbourName }}</h1>
      <div class="col-4 mb-1">
        <HarbourPicture :picture-data-base64="getImageData" />
        <br />
        <div>
          <button
            @click="openCaptainInfoModal"
            type="button"
            class="text-light btn btn-outline-light shadow-sm rounded-0 mb-3"
          >
            Sadamakapteni info
          </button>
        </div>
      </div>
      <div class="col-6">
        <ul class="list-group mb-3 glass-background" style="background-color: transparent">
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'location-dot']" />Aadress
              </div>
              {{ harbourDetailedInfo.locationAddress }}
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'map-location-dot']" />
                Koordinaadid
              </div>
              {{ harbourDetailedInfo.locationLongitude }},
              {{ harbourDetailedInfo.locationLatitude }}
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'arrow-down']" />
                Sissesõidu väikseim sügavus
              </div>
              {{ harbourDetailedInfo.minDepth }} meetrit
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'arrows-left-right']" />
                Sissesõidu väikseim laius
              </div>
              {{ harbourDetailedInfo.minWidth }} meetrit
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'anchor']" />
                Kohtade arv sadamas
              </div>
              {{ harbourDetailedInfo.spots }}
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                Navigatsiooniperioodi algus:
                {{ harbourDetailedInfo.navigationStart }}
              </div>
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                Navigatsiooniperioodi lõpp:
                {{ harbourDetailedInfo.navigationEnd }}
              </div>
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'phone']" />
                Kontakttelefon
              </div>
              {{ harbourDetailedInfo.phoneNumber }}
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">
                <font-awesome-icon :icon="['fas', 'house']" />
                <a :href="'https://' + harbourDetailedInfo.homepage" class="text-light">
                  {{ harbourDetailedInfo.homepage }}</a
                >
              </div>
            </div>
          </li>
          <li class="list-group-item bg-transparent border-0 rounded-0">
            <div class="ms-2 me-auto">
              <div class="fw-bold">Lisavõimalused</div>
              <div v-for="extra in harbourDetailedInfo.extras" :key="extra.extraId">
                <font-awesome-icon :icon="['fas', 'check']" />
                {{ extra.extraName }}
              </div>
            </div>
          </li>
        </ul>

        <div>
          <button
            @click="goBack"
            type="button"
            class="text-light btn btn-outline-light shadow-sm rounded-0 mb-3"
          >
            Tagasi sadamate juurde
          </button>
        </div>
      </div>
    </div>

    <div>
      <button
        @click="moveToEditHarbourPage"
        type="button"
        class="btn btn-dark btn-outline-light text-white shadow-sm rounded-0 m-2"
      >
        Muuda
      </button>
      <button
        @click="openDeleteHarbourModal"
        type="button"
        class="btn btn-danger btn-outline-light text-white shadow-sm rounded-0 m-2"
      >
        Kustuta
      </button>
    </div>
  </div>
</template>

<script>
import router from '@/router'
import CaptainInfoModal from '@/components/modal/CaptainInfoModal.vue'
import BookingModal from '@/components/modal/BookingModal.vue'
import DeleteHarbourModal from '@/components/modal/DeleteHarbourModal.vue'
import { DELETE_MODAL } from '@/assets/script/ModalType'
import HarbourPicture from '@/components/image/HarbourPicture.vue'

export default {
  name: 'HarbourDetails',
  components: { HarbourPicture, DeleteHarbourModal, BookingModal, CaptainInfoModal },
  emits: ['goBack'],
  props: {
    selectedHarbourId: Number,
  },
  computed: {
    getImageData() {
      return this.harbourDetailedInfo.pictures?.[0]?.pictureData || null
    },
  },
  data() {
    return {
      harbourDetailedInfo: {
        harbourId: 0,
        locationAddress: '',
        locationLongitude: 0,
        locationLatitude: 0,
        contactId: 0,
        harbourName: '',
        homepage: '',
        navigationStart: '',
        navigationEnd: '',
        minDepth: 0,
        minWidth: 0,
        spots: 0,
        phoneNumber: '',
        extras: [
          {
            extraId: 0,
            extraName: '',
            isAvailable: true,
          },
        ],
        pictures: [
          {
            pictureId: 0,
            pictureData: '',
          },
        ],
      },
    }
  },
  methods: {
    getHarbourDetailedInfo() {
      this.$http
        .get('/harbour', {
          params: {
            harbourId: this.selectedHarbourId,
          },
        })
        .then((response) => {
          this.harbourDetailedInfo = response.data
        })
        .catch((error) => {
          this.errorResponse = error.response.data
        })
    },
    openCaptainInfoModal() {
      this.$refs.captainInfoModalRef.openModal({
        contactId: this.harbourDetailedInfo.contactId,
      })
    },
    openDeleteHarbourModal() {
      this.$refs.deleteHarbourModalRef.openModal({
        harbourId: this.harbourDetailedInfo.harbourId,
        DELETE_MODAL,
      })
    },
    goBack() {
      this.$emit('goBack')
    },
    moveToEditHarbourPage() {
      router.push({
        name: 'editHarbourRoute',
        params: { id: this.selectedHarbourId },
      })
    },
    openBookingModal() {
      this.$refs.bookingModalRef.openModal()
    },
  },
  beforeMount() {
    this.getHarbourDetailedInfo()
  },
}
</script>
